kind: Template
apiVersion: v1
metadata:
  name: my-template-for-build-config
objects:

  - apiVersion: v1
    kind: BuildConfig
    metadata:
      name: app-build-${CDSID}
      labels:
        source: caas-workshop
    spec:
      output:
        pushSecret:
          name: devenablement-workshop-pull-secret
        to:
          kind: DockerImage
          name: registry.ford.com/devenablement/workshop:${QUAY_IMAGE_TAG}
      resources:
        requests:
          cpu: 250m
          memory: 250Mi
        limits:
          cpu: 500m
          memory: 500Mi
      source:
        dockerfile: |-
          FROM registry.redhat.io/rhscl/python-36-rhel7
          ARG LD_LIBRARY_PATH=/opt/rh/python36/root/usr/lib64
          ENV \
            HOME=/app \
            USER_UID=1001 \
            SUMMARY="A simple python web app built by ${CDSID} using a template."	\
            DESCRIPTION="This is a python web app to demonstrate basic container and kubernetes concepts." \
            NAME=${CDSID}
          WORKDIR $HOME
          COPY ./src $HOME
          RUN pip install --trusted-host pypi.python.org -r requirements.txt
          EXPOSE 8080
          USER $USER_UID
          CMD ["python", "app.py"]
        type: Dockerfile
      strategy:
        dockerStrategy:
          pullSecret:
            name: redhat-registry-pull-secret
        type: Docker
      successfulBuildsHistoryLimit: 5
      triggers: []
parameters:
  - name: QUAY_IMAGE_TAG
    description: Image tag to push to Quay
    required: true
  - name: CDSID
    description: User CDSID
    required: true
